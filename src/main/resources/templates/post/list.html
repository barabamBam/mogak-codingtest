<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title class="postTitle">Main Page</title>
  <link rel="stylesheet" th:href="@{/css/post/list.css}">
  <link rel="stylesheet" href="../../static/css/news-modal.css">
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
</head>
<body>
<div id="content-wrapper">

  <!-- í—¤ë” -->
  <div id="header">
    <div id="title">
      <p>MOGAKCOTE</p>
    </div>
    <div id="news">
      <button id="news-bell-btn">ğŸ””</button>

      <div id="news-modal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2>ì•Œë¦¼</h2>
          <div id="news-list"></div>
          <button id="load-more-btn">ë” ë³´ê¸°</button>
        </div>
      </div>

      <div id="news-info-modal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span>
          <h2 id="news-info-title"></h2>
          <p id="news-info-type"></p>
          <p id="news-info-created-at"></p>
          <p id="news-info-content"></p>
          <button id="news-info-related-btn" style="display: none;">ë°”ë¡œê°€ê¸°</button>
          <button id="news-info-back-btn">ë˜ëŒì•„ê°€ê¸°</button>
        </div>
      </div>
    </div>
  </div>

  <section id="notice-container">
    <h3 class="notice-container-title">ê³µì§€ì‚¬í•­</h3>
    <article class="notice-item" th:each="notice: ${notices}">
      <a class="notice-item-link" th:href="@{|/api/v1/notice/${notice.noticeId}|}">
        <p class="notice-title" th:text="${notice.title}">title</p>
        <p class="notice-date" th:text="${notice.createdAt.toLocalDate}">date</p>
      </a>
    </article>
  </section>
  <a th:href="@{|/api/v1/post|}" class="create-post-btn">ê²Œì‹œê¸€ ì‘ì„±</a>
  <form class="post-search" th:action="@{/api/v1/post/list}" method="get">
    <label for="search-input"></label>
    <input class="post-search-keyword" id="search-input" type="text" name="keyword" placeholder="ê²€ìƒ‰"
           th:value="${postSearchRequest.keyword != null} ? ${postSearchRequest.keyword}">
  </form>
  <div id="post-selector">
    <div class="selector-options">
      <div class="select-algorithm">
        <button class="label"
                th:text="${postSearchRequest.algorithm == null} ?
                        'ì•Œê³ ë¦¬ì¦˜' : ${postSearchRequest.algorithm}">ì•Œê³ ë¦¬ì¦˜
        </button>
        <ul class="selector-option hidden" id="algorithm">
          <li value="null">ì„ íƒ</li>
          <li value="Bellman-ford">Bellman-ford</li>
          <li value="BFS">BFS</li>
          <li value="DFS">DFS</li>
          <li value="BruteForce">BruteForce</li>
          <li value="DP">DP</li>
          <li value="Dijkstra's">Dijkstra's</li>
          <li value="Graph">Graph</li>
          <li value="Greedy">Greedy</li>
          <li value="Hash">Hash</li>
          <li value="Heap">Heap</li>
          <li value="Stack">Stack</li>
          <li value="Queue">Queue</li>
          <li value="String">String</li>
          <li value="Sort">Sort</li>
          <li value="SQL">SQL</li>
          <li value="Tree">Tree</li>
          <li value="Recursion">Recursion</li>
        </ul>
      </div>
      <div class="select-language">
        <button class="label"
                th:text="${postSearchRequest.language == null} ?
                        'ì‘ì„± ì–¸ì–´' : ${postSearchRequest.language}">ì‘ì„± ì–¸ì–´
        </button>
        <ul class="selector-option hidden" id="language">
          <li value="null">ì„ íƒ</li>
          <li value="Java">Java</li>
          <li value="Python">Python</li>
          <li value="C">C</li>
          <li value="C++">C++</li>
          <li value="C#">C#</li>
          <li value="Go">Go</li>
          <li value="JavaScript">Javascript</li>
          <li value="Kotlin">Kotlin</li>
          <li value="Ruby">Ruby</li>
          <li value="Swift">Swift</li>
          <li value="SQL">SQL</li>
        </ul>
      </div>
      <div class="select-checkSuccess">
        <button class="label"
                th:text="${postSearchRequest.checkSuccess} ? 'ì„±ê³µ' : 'ë¬´ê´€'">
          ì½”ë“œ ê²°ê³¼
        </button>
        <ul class="selector-option hidden" id="checkSuccess">
          <li value="null">ì„ íƒ</li>
          <li value="false">ë¬´ê´€</li>
          <li value="true">ì„±ê³µ</li>
        </ul>
      </div>
    </div>
    <div class="pagination-sort">
      <!-- ${posts.totalPages <= 1 ? (posts.number / 10) * 10 + 1 : -->
      <div class="page-container" th:data-page="${posts.number}">
        <p th:text="${((posts.number / 10) * 10 + 1) + ' - ' + ((posts.number / 10) * 10 + 10)}"></p>
        <a th:href="${posts.hasPrevious() ? '?page='+posts.number : null}"
           class="page_prev" th:classappend="${!posts.hasPrevious()} ? disabled : null ">
          <span class="arrow"></span>
        </a>
        <a th:href="${posts.hasNext() ? '?page='+(posts.number+2): null}"
           class="page_next" th:classappend="${!posts.hasNext()} ? disabled : null ">
          <span class="arrow"></span>
        </a>
      </div>
      <div class="select-sortBy">
        <button class="label" th:if="${postSearchRequest.sortBy == 'OLDEST'}">ì˜¤ë˜ëœ ìˆœ</button>
        <button class="label" th:if="${postSearchRequest.sortBy == 'MOST_VIEWED'}">ì¡°íšŒìˆ˜ ìˆœ</button>
        <button class="label" th:if="${postSearchRequest.sortBy == 'MOST_LIKED'}">ì¶”ì²œ ìˆœ</button>
        <button class="label"
                th:if="${postSearchRequest.sortBy == null || postSearchRequest.sortBy == 'LATEST'}">
          ìµœì‹  ìˆœ
        </button>
        <ul class="sort-option hidden" id="sortBy">
          <li value="LATEST">ìµœì‹  ìˆœ</li>
          <li value="OLDEST">ì˜¤ë˜ëœ ìˆœ</li>
          <li value="MOST_VIEWED">ì¡°íšŒìˆ˜ ìˆœ</li>
          <li value="MOST_LIKED">ì¶”ì²œ ìˆœ</li>
        </ul>
      </div>

    </div>
  </div>
    <main id="post-list">
        <p th:if="${posts.isEmpty()}" id="no-post">ê²€ìƒ‰ ì¡°ê±´ê³¼ ì¼ì¹˜í•˜ëŠ” ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        <article class="post-item" th:each="post: ${posts}">
            <a th:href="@{|/api/v1/posts/${post.id}|}">
                <h2 class="post-title" th:text="${post.title}">title</h2>
                <!-- user nickname ë°›ì•„ì˜¤ê¸° -->
                <p class="post-author" th:text="${post.nickname}">nickname</p>
                <p class="post-date" th:text="${post.createdAt.toLocalDate()}">date</p>
                <p class="post-content" th:text="${#strings.abbreviate(post.content,300)}">content</p>
                <!-- ë¬¸ì œ ë‚´ìš© ë°›ì•„ì˜¤ê¸° -->
                <div class="post-algorithm">
                    <span class="post-algorithm-hashtag">#Algorithm</span>
                    <span class="post-algorithm-hashtag" th:each="algorithm: ${post.algorithms}"
                          th:if="${algorithm != null}" th:text="'#'+${algorithm}"></span>
                </div>
                <p class="view-count" th:text="${post.viewCnt}+' views'">29 views</p>
            </a>
        </article>
    </main>
</div>


<script>
  const urlParams = new URLSearchParams(window.location.search);

  const labels = document.querySelectorAll(".label");
  const pageNum = document.querySelector(".page-container").dataset.page;
  let prevButton = document.querySelector(".page_prev");
  let nextButton = document.querySelector(".page_next");

  document.querySelector("form").action += location.search;

  labels.forEach(label => {
    label.addEventListener('click', function () {
      const select = label.nextElementSibling;
      select.classList.toggle("hidden");
      select.childNodes.forEach(option => {
        option.addEventListener('click', function () {
          const key = select.id;
          const value = option.getAttribute('value');

          updateQueryParam(key, value);

        });
      })
    });
  });

  const existPageString = location.search.includes("page");

  if (!existPageString) {
    prevButton.href = location.search;

    if (location.search.length > 0) {
      prevButton.href += "&page=" + parseInt(pageNum);
    } else {
      prevButton.href += "?page=" + parseInt(pageNum);
    }

  } else {
    urlParams.set("page", pageNum);
    prevButton.href = window.location.pathname + '?' + urlParams.toString();
  }

  if (!existPageString) {
    nextButton.href = location.search;

    if (location.search.length > 0) {
      nextButton.href += "&page=" + (parseInt(pageNum) + 2);
    } else {
      nextButton.href += "?page=" + (parseInt(pageNum) + 2);
    }

  } else {
    urlParams.set("page", (parseInt(pageNum) + 2).toString())
    nextButton.href = window.location.pathname + '?' + urlParams.toString();
  }

  if (!location.search.includes("checkSuccess")) {
    document.querySelector(".select-checkSuccess .label").textContent = 'ì½”ë“œ ê²°ê³¼';
  }

  // í˜„ì¬ URLì—ì„œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì¶”ì¶œí•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
  function updateQueryParam(key, value) {

    // ê¸°ì¡´ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ ë™ì¼í•œ í‚¤ê°€ ìˆìœ¼ë©´ ê°’ì„ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ì¶”ê°€
    if (value && value !== "null") {
      urlParams.set(key, value);
    } else {
      urlParams.delete(key);
    }
    urlParams.delete("page");

    // ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ë¥¼ ì—…ë°ì´íŠ¸í•œ URLë¡œ ë³€ê²½
    const newUrl = window.location.pathname + '?' + urlParams.toString();
    location.href = urlParams.toString() !== '' ? newUrl : window.location.pathname;

  }


</script>

<!-- ì•Œë¦¼ ëª¨ë‹¬ script -->
<script th:src="@{/js/news-modal.js}"></script>

</body>
